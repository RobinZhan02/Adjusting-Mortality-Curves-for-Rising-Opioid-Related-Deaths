---
title: "Wonder EDA"
output: html_document
---

```{r message=FALSE}
library(dplyr)
library(ggplot2)
library(stringr)
library(readxl)
library(forecast)
library(lubridate)
library(tseries)
```

```{r warning=FALSE}
census_region <- read.csv("~/Adjusting-Mortality-Curves-for-Rising-Opioid-Related-Deaths/data/WONDER-Census Region.csv") %>%
  filter(Year != "NA")

ggplot(census_region, aes(x = Year, y = Crude.Rate, color = Census.Region, group = Census.Region)) +
  geom_line(linewidth = 0.75) +
  geom_ribbon(aes(ymin = Crude.Rate.Lower.95..Confidence.Interval, ymax = Crude.Rate.Upper.95..Confidence.Interval, fill = Census.Region), alpha = 0.5, color = NA) +
  theme_minimal() +
  labs(
    title = "Opioid Death Rate By Region Over Time",
    x = "Year", y = "Rate per 100,000"
  ) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 15), 
        legend.title = element_blank(),
        legend.position = c(0.15, 0.85))
```

```{r warning=FALSE}
census_division <- read.csv("~/Adjusting-Mortality-Curves-for-Rising-Opioid-Related-Deaths/data/WONDER-Census Division.csv") %>%
  filter(Year != "NA")

ggplot(census_division, aes(x = Year, y = Crude.Rate, color = Census.Division, group = Census.Division)) +
  geom_line(linewidth = 0.75) +
  geom_ribbon(aes(ymin = Crude.Rate.Lower.95..Confidence.Interval, ymax = Crude.Rate.Upper.95..Confidence.Interval, fill = Census.Division), alpha = 0.5, color = NA) +
  theme_minimal() +
  labs(
    title = "Opioid Death Rate By Division Over Time",
    x = "Year", y = "Rate per 100,000"
  ) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 15), 
        legend.title = element_blank(),
        legend.position = c(0.15, 0.7))
```

```{r warning=FALSE}
sex <- read.csv("~/Adjusting-Mortality-Curves-for-Rising-Opioid-Related-Deaths/data/WONDER-Sex.csv") %>%
  filter(Year != "NA")

ggplot(sex, aes(x = Year, y = Crude.Rate, color = Sex, group = Sex)) +
  geom_line(linewidth = 0.75) +
  geom_ribbon(aes(ymin = Crude.Rate.Lower.95..Confidence.Interval, ymax = Crude.Rate.Upper.95..Confidence.Interval, fill = Sex), alpha = 0.5, color = NA) +
  theme_minimal() +
  labs(
    title = "Opioid Death Rate By Sex Over Time",
    x = "Year", y = "Rate per 100,000"
  ) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 15), 
        legend.title = element_blank())
```

```{r warning=FALSE}
age_order <- c(
  "< 1 year", "1-4 years", "5-14 years", "15-24 years",
  "25-34 years", "35-44 years", "45-54 years",
  "55-64 years", "65-74 years", "75-84 years", "85+ years"
)

ten_year <- read.csv("~/Adjusting-Mortality-Curves-for-Rising-Opioid-Related-Deaths/data/WONDER-10YrAge.csv") %>%
  filter(! Ten.Year.Age.Groups.Code %in% c("1","1-4","NS"),
         Year > 2003) %>%
  mutate(Crude.Rate = as.numeric(Crude.Rate),
         Crude.Lower = as.numeric(Crude.Rate.Lower.95..Confidence.Interval),
         Crude.Upper = as.numeric(Crude.Rate.Upper.95..Confidence.Interval),
         Ten.Year.Age.Groups = factor(Ten.Year.Age.Groups, levels = age_order))

ggplot(ten_year, aes(x = Year, y = Crude.Rate, color = Ten.Year.Age.Groups, group = Ten.Year.Age.Groups)) +
  geom_line(linewidth = 1) +
  geom_ribbon(aes(ymin = as.numeric(Crude.Lower), ymax = as.numeric(Crude.Upper), fill = Ten.Year.Age.Groups), alpha = 0.5, color = NA) +
  theme_minimal() +
  labs(
    title = "Opioid Death Rate By 10-year Age Group Over Time",
    x = "Year", y = "Rate per 100,000") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(size = 15))
```

```{r warning=FALSE}
age_order <- c("< 1 year","1-4 years","5-9 years","10-14 years","15-19 years","20-24 years","25-29 years","30-34 years","35-39 years","40-44 years","45-49 years","50-54 years","55-59 years","60-64 years ","65-69 years","70-74 years","75-79 years","80-84 years","85-89 years", "90-94 years", "95-99 years", "100+ years")

five_year <- read.csv("~/Adjusting-Mortality-Curves-for-Rising-Opioid-Related-Deaths/data/WONDER-5YrAge.csv") %>%
  filter(! Five.Year.Age.Groups.Code %in% c("1","1-4","5-9","10-14","85-89","90-94","95-99", "100+","NS"),
         Year > 2003) %>%
  mutate(Crude.Rate = as.numeric(Crude.Rate),
         Crude.Lower = as.numeric(Crude.Rate.Lower.95..Confidence.Interval),
         Crude.Upper = as.numeric(Crude.Rate.Upper.95..Confidence.Interval),
         Five.Year.Age.Groups = factor(Five.Year.Age.Groups, levels = age_order))

ggplot(five_year, aes(x = Year, y = Crude.Rate, color = Five.Year.Age.Groups, group = Five.Year.Age.Groups)) +
  geom_line(linewidth = 1) +
  geom_ribbon(aes(ymin = as.numeric(Crude.Lower), ymax = as.numeric(Crude.Upper), fill = Five.Year.Age.Groups), alpha = 0.5, color = NA) +
  theme_minimal() +
  labs(
    title = "Opioid Death Rate By 5-year Age Group Over Time",
    x = "Year", y = "Rate per 100,000") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(size = 15))
```